@using PerfumeStore.Application.Dtos.CartDtos

@model  GetByIdCartDto
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Səbət</title>

    <style>
        body {
        background-color: #f8f9fa;
        }

        .cart-table th {
        background-color: #343a40;
        color: white;
        }

        .cart-table td,
        .cart-table th {
        vertical-align: middle;
        }

        .cart-img {
        width: 70px;
        height: 70px;
        border-radius: 8px;
        }

        .remove-btn {
        background-color: transparent;
        border: none;
        color: #dc3545;
        font-size: 1.2rem;
        }

        .remove-btn:hover {
        color: #a71d2a;
        }

        .btn-checkout {
        background-color: #e83e8c;
        border: none;
        color: white;
        }

        .btn-checkout1 {
        background-color: lightgray;
        border: none;
        color: white;
        }
        .btn-checkout:hover {
        background-color: #d63384;
        }

       @*----- MEhsul olmayanda bos sehife *@

               /* Cart Page General */
        .cart-page {
          padding: 60px 0;
          background: #f9f9fb;
          min-height: 70vh;
        }

        .cart-title {
          text-align: center;
          font-size: 2.2rem;
          margin-bottom: 40px;
          color: #333;
          font-weight: 700;
          position: relative;
          margin-top:50px;

        }
      
        .cart-title::after {
          content: "";
          display: block;
          width: 60px;
          height: 3px;
          background: #ff5a5f;
          margin: 12px auto 0;
          border-radius: 10px;
        }

        /* Cart Content */
        .cart-content {
          background: #fff;
          border-radius: 16px;
          padding: 25px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        /* Empty Cart */
        .empty-cart {
          text-align: center;
          padding: 60px 20px;
          background: #fff;
          border-radius: 16px;
          margin-top: 40px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.06);
        }

        .empty-cart i {
          font-size: 70px;
          color: #ff5a5f;
          margin-bottom: 20px;
        }

        .empty-cart h3 {
          font-size: 1.8rem;
          margin-bottom: 10px;
          color: #333;
        }

        .empty-cart p {
          color: #666;
          margin-bottom: 25px;
          font-size: 1rem;
        }

        .empty-cart .continue-shopping {
          display: inline-block;
          padding: 12px 25px;
          background: #ff5a5f;
          color: #fff;
          border-radius: 30px;
          text-decoration: none;
          font-weight: 600;
          transition: 0.3s;
        }

        .empty-cart .continue-shopping:hover {
          background: #e0484c;
          transform: translateY(-2px);
        }


    </style>
</head>
<body>

    @if (Model.CartItems!= null&& Model.CartItems.Any())
    { 
        <h2 style="margin-top:100px" class="cart-title">🛒 Səbətim</h2>
        <div class="container py-5" style="margin-top:50px">
            <h2 class="mb-4 fw-bold text-center">Səbətinizdəki məhsullar</h2>

            <!-- Cart Table -->
            <div class="table-responsive mb-5">
                <table class="table cart-table align-middle" style="text-align:center">
                    <thead>

                        <tr style="text-align:center">
                            <th>Məhsul</th>
                            <th>Məhsulun adı</th>
                            <th>Həcm</th>
                            <th>Miqdar</th>
                            <th>Qiymət</th>
                            <th>Sil</th>
                            
                        </tr>



                    </thead>

                    <tbody>

                        @if (Model?.CartItems != null)
                        {
                            @foreach (var item in Model.CartItems)
                            {
                                <tr style="font-size:20px;text-align:center">

                                    <td style="display:flex">
                                        <img style="height:120px;width:120px" src="@item.ProductVariant.ProductImageUrl" class="cart-img" alt="">
                                    </td>
                                    <td><h6 style="font-size:20px;margin: 0 0 0 20px" class="mb-1">@item.ProductVariant.ProductName</h6></td>
                                    <td>@item.ProductVariant.Size</td>
                                    <td style="width: 120px;">
                                        <input type="number"
                                        class="form-control text-center quantity-input"
                                        data-id="@item.CartItemId"
                                        value="@item.Quantity"
                                        min="1"
                                        style="width:80px;" />
                                    </td>
                                    <td><strong>@item.TotalPrice.ToString("0.##") ₼</strong></td>
                                    <td class="text-center">
                                        <form asp-controller="Cart" asp-action="DeleteCartItem" asp-route-id="@item.CartItemId" method="post" onsubmit="return confirm('Silmək istədiyinizə əminsiniz?')">
                                            <button type="submit" class="remove-btn btn btn-sm " title="Sil">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>

                            }

                        }
                        <!-- Cart Model Row -->
                        <!-- Başqa məhsul da əlavə oluna bilər -->
                    </tbody>
                </table>
            </div>

            <!-- Checkout Summary -->
            <div class="row justify-content-end">
                <div class="col-md-5">
                    <div class="bg-white p-4 rounded shadow-sm">
                        <h5 class="mb-3">Sifariş Xülasəsi</h5>
                        <ul class="list-unstyled">
                            <li class="d-flex justify-content-between">
                                <span>Toplam:</span>
                                <strong>@Model?.TotalAmount</strong>
                            </li>
                            <li class="d-flex justify-content-between">
                                <span>Çatdırılma:</span>
                                <span>0 AZN</span>
                            </li>
                            <li class="d-flex justify-content-between border-top pt-2">
                                <span>Ümumi: </span>
                                <strong>@Model?.TotalAmount</strong>
                            </li>
                        </ul>
                        <a href="/Home" class="btn btn-checkout1 w-100 mt-3">Alış-verişə davam et</a>
                        <a href="/Checkout" class="btn btn-checkout w-100 mt-3">Sifarişi Tamamla</a>
                    </div>
                </div>
            </div>

        </div>

    }
    else
    {
        <main class="site-main">
            <section class="cart-page">
                <div class="container">
                    <h2 class="cart-title">🛒 Səbətim</h2>

                  
                </div>

                <!-- Empty Cart -->
                <div class="empty-cart">
                    <i class="ti-shopping-cart"></i>
                    <h3>Səbətiniz boşdur</h3>
                    <p>Alış-verişə davam etmək üçün məhsullar əlavə edin</p>
                    <a href="/Kataloq" class="continue-shopping">Alış-verişə davam et</a>
                </div>
            </section>
        </main>
    }



    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/your-kit-code.js" crossorigin="anonymous"></script>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('.quantity-input').on('input', function () {
            const cartItemId = $(this).data('id');
            const newQuantity = parseInt($(this).val());

            // Əgər dəyər keçərsizdirsə, heç nə etmə
            if (isNaN(newQuantity) || newQuantity <= 0) {
                return;
            }

            // JSON obyektini hazırla
            const data = {
                CartItemId: cartItemId,
                Quantity: newQuantity
            };

            // AJAX sorğusu göndər
            $.ajax({
                url: '/Cart/UpdateCartItemAjax',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (res) {
                    if (res.success) {
                        location.reload(); // səhifəni yenilə, yeni məbləğlər görünsün
                    } else {
                        alert(res.message);
                    }
                },
                error: function () {
                    alert("Xəta baş verdi.");
                }
            });
        });
    });
</script>
